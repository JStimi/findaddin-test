<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Findest Office Add-in</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            overflow: hidden;
        }
        #root {
            width: 100%;
            height: 100vh;
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.05; }
            50% { opacity: 0.1; }
        }
        .animate-pulse {
            animation: pulse 3s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;
        
        const SearchIcon = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
            </svg>
        );
        
        const FileTextIcon = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
                <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
        );
        
        const LightbulbIcon = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"></path>
                <path d="M9 18h6"></path>
                <path d="M10 22h4"></path>
            </svg>
        );
        
        const ChevronDownIcon = ({ className, size }) => (
            <svg className={className} width={size || 18} height={size || 18} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
        );
        
        const ExternalLinkIcon = () => (
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                <polyline points="15 3 21 3 21 9"></polyline>
                <line x1="10" y1="14" x2="21" y2="3"></line>
            </svg>
        );
        
        const BookOpenIcon = ({ size }) => (
            <svg width={size || 20} height={size || 20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
            </svg>
        );

        const FindestAddin = () => {
            const [isProjectDropdownOpen, setIsProjectDropdownOpen] = useState(false);
            const [selectedProject, setSelectedProject] = useState(null);
            const [projectSearchQuery, setProjectSearchQuery] = useState('');
            const [sourceSearchQuery, setSourceSearchQuery] = useState('');
            const [askIgorQuery, setAskIgorQuery] = useState('');
            const [askIgorResponse, setAskIgorResponse] = useState(null);
            const [isLoading, setIsLoading] = useState(false);

            const mockProjects = [
                { id: 1, name: 'Veterinary Periodontal Research 2024', sourceCount: 47 },
                { id: 2, name: 'Canine Nutrition Studies', sourceCount: 32 },
                { id: 3, name: 'Feline Behavioral Analysis', sourceCount: 28 },
                { id: 4, name: 'Small Animal Surgery Protocols', sourceCount: 19 },
                { id: 5, name: 'Veterinary Dermatology Cases', sourceCount: 41 }
            ];

            const mockSources = [
                { id: 1, title: 'Catechin Treatment Effects on Periodontal Pathogens', authors: 'Smith et al.', year: 2023, url: 'https://example.com/study-1' },
                { id: 2, title: 'Periodontal Disease Prevalence in Small Breeds', authors: 'Johnson & Lee', year: 2024, url: 'https://example.com/study-2' },
                { id: 3, title: 'Anti-inflammatory Properties of Green Tea Extract', authors: 'Chen et al.', year: 2023, url: 'https://example.com/study-3' },
                { id: 4, title: 'Biofilm Formation in Canine Oral Cavity', authors: 'Martinez', year: 2024, url: 'https://example.com/study-4' },
                { id: 5, title: 'Halitosis Management in Companion Animals', authors: 'Brown & Davis', year: 2023, url: 'https://example.com/study-5' }
            ];

            const mockAskIgorResponse = `Pros and Cons of Catechin Treatment for Periodontal Disease in Dogs and Cats

Pros:
• Catechin isolated from Japanese green tea significantly inhibits the growth of periodontal pathogens Porphyromonas gulae and Porphyromonas gingivalis in vitro in a dose-dependent manner. It also significantly suppresses hydrogen sulfide and methyl mercaptan production, which are major contributors to halitosis, even after short exposure. [Ref]
• Catechin treatment significantly inhibits pro-inflammatory cytokine production (IL-1β, IL-6, TNFα) and phosphorylation of MAPKs (p-38, JNK) induced by P. gulae in vitro. [Ref]
• Daily oral treatment with catechin-containing wet food for 1 month significantly ameliorated halitosis and reduced P. gulae activity in both dogs and cats with periodontal disease. [Ref]

Cons:
• Catechin treatment had no significant impact on dental plaque and gingivitis in clinical studies after 1 month of treatment. [Ref]
• The inhibitory effect on biofilm formation was statistically significant but of small magnitude (<10% inhibition), even at the highest concentration tested. [Ref]
• Longer treatment periods may be required to exhibit effects on gingivitis and plaque index; short-term treatment is a limitation. [Ref]`;

            const filteredProjects = mockProjects.filter(project =>
                project.name.toLowerCase().includes(projectSearchQuery.toLowerCase())
            );

            const filteredSources = mockSources.filter(source =>
                source.title.toLowerCase().includes(sourceSearchQuery.toLowerCase()) ||
                source.authors.toLowerCase().includes(sourceSearchQuery.toLowerCase())
            );

            const handleSelectProject = (project) => {
                setSelectedProject(project);
                setIsProjectDropdownOpen(false);
                setProjectSearchQuery('');
            };

            const handleAskIgor = () => {
                if (!askIgorQuery.trim()) return;
                setIsLoading(true);
                setTimeout(() => {
                    setAskIgorResponse(mockAskIgorResponse);
                    setIsLoading(false);
                }, 1500);
            };

            const insertSource = (source) => {
                // This will use Office.js to insert citation
                if (typeof Office !== 'undefined' && Office.context && Office.context.document) {
                    Office.context.document.setSelectedDataAsync(
                        `${source.authors} (${source.year}). ${source.title}. Retrieved from ${source.url}`,
                        { coercionType: Office.CoercionType.Text },
                        (result) => {
                            if (result.status === Office.AsyncResultStatus.Succeeded) {
                                alert('✓ Citation inserted successfully!');
                            }
                        }
                    );
                } else {
                    alert(`✓ Citation inserted!\n\n${source.authors} (${source.year}). ${source.title}.\n\n(Office.js would insert this into the document)`);
                }
            };

            const insertToDocument = (text) => {
                // This will use Office.js to insert content
                if (typeof Office !== 'undefined' && Office.context && Office.context.document) {
                    Office.context.document.setSelectedDataAsync(
                        text,
                        { coercionType: Office.CoercionType.Text },
                        (result) => {
                            if (result.status === Office.AsyncResultStatus.Succeeded) {
                                alert('✓ Content inserted successfully!');
                            }
                        }
                    );
                } else {
                    alert(`✓ Content would be inserted!\n\n(Office.js would insert the full response into the document)`);
                }
            };

            return (
                <div style={{ height: '100vh', backgroundColor: '#0A0C12', color: '#F9FAF9', display: 'flex', flexDirection: 'column', overflow: 'hidden', position: 'relative' }}>
                    {/* Animated background effects */}
                    <div style={{ position: 'absolute', inset: 0, overflow: 'hidden', pointerEvents: 'none' }}>
                        <div className="animate-pulse" style={{ position: 'absolute', top: '25%', left: '-3rem', width: '12rem', height: '12rem', backgroundColor: '#FDFF00', opacity: 0.05, filter: 'blur(3rem)', borderRadius: '9999px' }}></div>
                        <div style={{ position: 'absolute', bottom: '33%', right: '-3rem', width: '10rem', height: '10rem', backgroundColor: '#006A86', opacity: 0.1, filter: 'blur(3rem)', borderRadius: '9999px' }}></div>
                        <div className="animate-pulse" style={{ position: 'absolute', top: '66%', left: '50%', width: '8rem', height: '8rem', backgroundColor: '#84A7E2', opacity: 0.05, filter: 'blur(2rem)', borderRadius: '9999px', animationDelay: '1s' }}></div>
                    </div>

                    {/* Header */}
                    <div style={{ position: 'relative', zIndex: 10, padding: '1rem', borderBottom: '1px solid rgba(0, 106, 134, 0.2)' }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', marginBottom: '0.75rem' }}>
                            <div style={{ fontSize: '1.5rem', fontWeight: 300 }}>
                                <span style={{ color: '#FDFF00' }}>Find</span>
                                <span style={{ color: '#F9FAF9' }}>est</span>
                            </div>
                            <div style={{ flex: 1 }}></div>
                            <BookOpenIcon size={20} />
                        </div>
                        <div style={{ height: '2px', width: '100%', background: 'linear-gradient(to right, #006A86, #FDFF00, transparent)', borderRadius: '9999px', opacity: 0.3 }}></div>
                    </div>

                    {/* Main Content */}
                    <div style={{ position: 'relative', zIndex: 10, flex: 1, overflowY: 'auto', padding: '1rem' }}>
                        
                        {/* Project Selection Dropdown */}
                        <div style={{ marginBottom: '1.5rem' }}>
                            <label style={{ display: 'block', fontSize: '0.75rem', fontWeight: 500, color: 'rgba(249, 250, 249, 0.7)', letterSpacing: '0.05em', textTransform: 'uppercase', marginBottom: '0.5rem' }}>Project</label>
                            <div style={{ position: 'relative' }}>
                                <button
                                    onClick={() => setIsProjectDropdownOpen(!isProjectDropdownOpen)}
                                    style={{ width: '100%', backgroundColor: '#0A0C12', border: '1px solid rgba(0, 106, 134, 0.4)', borderRadius: '0.5rem', padding: '0.75rem 1rem', fontSize: '0.875rem', textAlign: 'left', display: 'flex', alignItems: 'center', justifyContent: 'space-between', cursor: 'pointer', transition: 'all 0.3s' }}
                                >
                                    <span style={{ color: selectedProject ? '#F9FAF9' : 'rgba(249, 250, 249, 0.5)' }}>
                                        {selectedProject ? selectedProject.name : 'Select a project...'}
                                    </span>
                                    <ChevronDownIcon className={isProjectDropdownOpen ? 'rotate-180' : ''} size={18} />
                                </button>

                                {isProjectDropdownOpen && (
                                    <div style={{ position: 'absolute', top: '100%', left: 0, right: 0, marginTop: '0.5rem', backgroundColor: '#0A0C12', border: '1px solid rgba(0, 106, 134, 0.4)', borderRadius: '0.5rem', boxShadow: '0 20px 25px -5px rgba(0, 0, 0, 0.5)', overflow: 'hidden', zIndex: 20 }}>
                                        <div style={{ padding: '0.5rem', borderBottom: '1px solid rgba(0, 106, 134, 0.2)' }}>
                                            <div style={{ position: 'relative' }}>
                                                <div style={{ position: 'absolute', left: '0.75rem', top: '50%', transform: 'translateY(-50%)' }}>
                                                    <SearchIcon />
                                                </div>
                                                <input
                                                    type="text"
                                                    placeholder="Search projects..."
                                                    value={projectSearchQuery}
                                                    onChange={(e) => setProjectSearchQuery(e.target.value)}
                                                    style={{ width: '100%', backgroundColor: '#0A0C12', border: '1px solid rgba(0, 106, 134, 0.3)', borderRadius: '0.375rem', paddingLeft: '2.25rem', paddingRight: '0.75rem', paddingTop: '0.5rem', paddingBottom: '0.5rem', fontSize: '0.75rem', color: '#F9FAF9', outline: 'none' }}
                                                    onClick={(e) => e.stopPropagation()}
                                                />
                                            </div>
                                        </div>
                                        <div style={{ maxHeight: '16rem', overflowY: 'auto' }}>
                                            {filteredProjects.map((project) => (
                                                <button
                                                    key={project.id}
                                                    onClick={() => handleSelectProject(project)}
                                                    style={{ width: '100%', textAlign: 'left', padding: '0.75rem 1rem', borderBottom: '1px solid rgba(0, 106, 134, 0.1)', cursor: 'pointer', backgroundColor: 'transparent', border: 'none', color: '#F9FAF9', transition: 'background-color 0.2s' }}
                                                    onMouseEnter={(e) => e.target.style.backgroundColor = 'rgba(0, 106, 134, 0.2)'}
                                                    onMouseLeave={(e) => e.target.style.backgroundColor = 'transparent'}
                                                >
                                                    <div style={{ fontSize: '0.875rem', fontWeight: 500 }}>{project.name}</div>
                                                    <div style={{ fontSize: '0.75rem', color: '#84A7E2', marginTop: '0.25rem' }}>{project.sourceCount} sources</div>
                                                </button>
                                            ))}
                                            {filteredProjects.length === 0 && (
                                                <div style={{ padding: '1.5rem 1rem', textAlign: 'center', fontSize: '0.875rem', color: 'rgba(249, 250, 249, 0.5)' }}>
                                                    No projects found
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Sources Section */}
                        {selectedProject && (
                            <div style={{ marginBottom: '1.5rem' }}>
                                <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', marginBottom: '0.75rem' }}>
                                    <FileTextIcon />
                                    <h2 style={{ fontSize: '0.875rem', fontWeight: 500, letterSpacing: '0.025em', margin: 0 }}>Sources</h2>
                                </div>
                                
                                <div style={{ position: 'relative', marginBottom: '0.75rem' }}>
                                    <div style={{ position: 'absolute', left: '0.75rem', top: '50%', transform: 'translateY(-50%)' }}>
                                        <SearchIcon />
                                    </div>
                                    <input
                                        type="text"
                                        placeholder="Search by title or author..."
                                        value={sourceSearchQuery}
                                        onChange={(e) => setSourceSearchQuery(e.target.value)}
                                        style={{ width: '100%', backgroundColor: '#0A0C12', border: '1px solid rgba(0, 106, 134, 0.3)', borderRadius: '0.5rem', paddingLeft: '2.25rem', paddingRight: '0.75rem', paddingTop: '0.625rem', paddingBottom: '0.625rem', fontSize: '0.875rem', color: '#F9FAF9', outline: 'none' }}
                                    />
                                </div>

                                <div style={{ maxHeight: '20rem', overflowY: 'auto', paddingRight: '0.25rem' }}>
                                    {filteredSources.map((source) => (
                                        <div
                                            key={source.id}
                                            style={{ padding: '0.75rem', borderRadius: '0.5rem', backgroundColor: '#0A0C12', border: '1px solid rgba(0, 106, 134, 0.2)', marginBottom: '0.5rem', transition: 'border-color 0.3s' }}
                                        >
                                            <div style={{ fontSize: '0.875rem', fontWeight: 500, color: '#F9FAF9', marginBottom: '0.25rem', lineHeight: 1.3 }}>
                                                {source.title}
                                            </div>
                                            <div style={{ fontSize: '0.75rem', color: '#84A7E2', marginBottom: '0.5rem' }}>
                                                {source.authors} ({source.year})
                                            </div>
                                            <button
                                                onClick={() => insertSource(source)}
                                                style={{ width: '100%', backgroundColor: 'rgba(0, 106, 134, 0.3)', color: '#FDFF00', padding: '0.375rem 0.75rem', borderRadius: '0.375rem', fontSize: '0.75rem', fontWeight: 500, border: 'none', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '0.375rem', transition: 'all 0.3s' }}
                                                onMouseEnter={(e) => e.target.style.backgroundColor = 'rgba(0, 106, 134, 0.5)'}
                                                onMouseLeave={(e) => e.target.style.backgroundColor = 'rgba(0, 106, 134, 0.3)'}
                                            >
                                                <ExternalLinkIcon />
                                                Insert Citation
                                            </button>
                                        </div>
                                    ))}
                                    {filteredSources.length === 0 && (
                                        <div style={{ textAlign: 'center', padding: '2rem 0', fontSize: '0.875rem', color: 'rgba(249, 250, 249, 0.5)' }}>
                                            No sources found
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* AskIGOR Q&A Section */}
                        {selectedProject && (
                            <div style={{ marginBottom: '1rem' }}>
                                <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', marginBottom: '0.75rem' }}>
                                    <LightbulbIcon />
                                    <h2 style={{ fontSize: '0.875rem', fontWeight: 500, letterSpacing: '0.025em', margin: 0 }}>AskIGOR Q&A</h2>
                                </div>
                                
                                <textarea
                                    placeholder="Ask a question about your project..."
                                    value={askIgorQuery}
                                    onChange={(e) => setAskIgorQuery(e.target.value)}
                                    style={{ width: '100%', backgroundColor: '#0A0C12', border: '1px solid rgba(0, 106, 134, 0.3)', borderRadius: '0.5rem', padding: '0.75rem 1rem', fontSize: '0.875rem', color: '#F9FAF9', outline: 'none', resize: 'none', fontWeight: 300, fontFamily: 'inherit' }}
                                    rows={3}
                                />

                                <button
                                    onClick={handleAskIgor}
                                    disabled={isLoading || !askIgorQuery.trim()}
                                    style={{ width: '100%', backgroundColor: '#FDFF00', color: '#0A0C12', padding: '0.625rem 1rem', borderRadius: '0.5rem', fontWeight: 500, fontSize: '0.875rem', border: 'none', cursor: isLoading || !askIgorQuery.trim() ? 'not-allowed' : 'pointer', marginTop: '0.75rem', opacity: isLoading || !askIgorQuery.trim() ? 0.5 : 1, transition: 'all 0.3s' }}
                                >
                                    {isLoading ? 'Analyzing...' : 'Ask IGOR'}
                                </button>

                                {askIgorResponse && (
                                    <div style={{ marginTop: '0.75rem', padding: '1rem', borderRadius: '0.5rem', backgroundColor: '#0A0C12', border: '1px solid rgba(0, 106, 134, 0.3)' }}>
                                        <div style={{ fontSize: '0.75rem', color: 'rgba(249, 250, 249, 0.9)', whiteSpace: 'pre-wrap', marginBottom: '0.75rem', maxHeight: '24rem', overflowY: 'auto', fontWeight: 300, lineHeight: 1.6 }}>
                                            {askIgorResponse}
                                        </div>
                                        <button
                                            onClick={() => insertToDocument(askIgorResponse)}
                                            style={{ width: '100%', background: 'linear-gradient(to right, #006A86, #84A7E2)', color: '#F9FAF9', padding: '0.5rem 1rem', borderRadius: '0.5rem', fontSize: '0.875rem', fontWeight: 500, border: 'none', cursor: 'pointer', transition: 'all 0.3s' }}
                                        >
                                            Insert to Document
                                        </button>
                                    </div>
                                )}
                            </div>
                        )}

                        {!selectedProject && (
                            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', paddingTop: '4rem', paddingBottom: '4rem' }}>
                                <div style={{ textAlign: 'center', maxWidth: '20rem' }}>
                                    <div style={{ width: '4rem', height: '4rem', margin: '0 auto 1rem', borderRadius: '9999px', backgroundColor: 'rgba(0, 106, 134, 0.2)', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                                        <BookOpenIcon size={28} />
                                    </div>
                                    <p style={{ fontSize: '0.875rem', color: 'rgba(249, 250, 249, 0.6)', fontWeight: 300, lineHeight: 1.6 }}>
                                        Select a project above to browse sources and use AskIGOR
                                    </p>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Initialize Office and render
        Office.onReady((info) => {
            ReactDOM.render(<FindestAddin />, document.getElementById('root'));
        });
    </script>
</body>
</html>