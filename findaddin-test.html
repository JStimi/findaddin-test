<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Findest Office Add-in</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    <style>
        * { box-sizing: border-box; }
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
        }
        #root {
            width: 100%;
            height: 100vh;
        }
        .scrollable {
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #FDFF00 #0A0C12;
        }
        .scrollable::-webkit-scrollbar { width: 6px; }
        .scrollable::-webkit-scrollbar-track { background: #0A0C12; }
        .scrollable::-webkit-scrollbar-thumb { background: #006A86; border-radius: 3px; }
        .scrollable::-webkit-scrollbar-thumb:hover { background: #FDFF00; }
        @keyframes pulse {
            0%, 100% { opacity: 0.05; }
            50% { opacity: 0.1; }
        }
        .animate-pulse { animation: pulse 3s ease-in-out infinite; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;
        
        const FindestAddin = () => {
            const [isProjectDropdownOpen, setIsProjectDropdownOpen] = useState(false);
            const [selectedProject, setSelectedProject] = useState(null);
            const [projectSearchQuery, setProjectSearchQuery] = useState('');
            const [sourceSearchQuery, setSourceSearchQuery] = useState('');
            const [askIgorQuery, setAskIgorQuery] = useState('');
            const [askIgorResponse, setAskIgorResponse] = useState(null);
            const [isLoadingIgor, setIsLoadingIgor] = useState(false);
            const [newSourceQuery, setNewSourceQuery] = useState('');
            const [isLoadingNewSources, setIsLoadingNewSources] = useState(false);
            const [newSources, setNewSources] = useState(null);

            const mockProjects = [
                { id: 1, name: 'Veterinary Periodontal Research 2024', sourceCount: 47 },
                { id: 2, name: 'Canine Nutrition Studies', sourceCount: 32 },
                { id: 3, name: 'Feline Behavioral Analysis', sourceCount: 28 }
            ];

            const mockSources = [
                { 
                    id: 1, 
                    year: 1978,
                    authors: 'University of Amsterdam, B. van Geel',
                    title: 'A palaeoecological study of holocene peat bog sections',
                    type: 'Science'
                },
                { 
                    id: 2, 
                    year: 1985,
                    authors: 'Utrecht University, J.H.J. Joosten',
                    title: 'A 130 year micro- and macrofossil record from regeneration peat',
                    type: 'Science'
                }
            ];

            const mockAskIgorResponse = `Pros and Cons of Catechin Treatment

Pros:
• Catechin significantly inhibits periodontal pathogens [Ref]
• Reduces halitosis in clinical studies [Ref]
• Daily treatment shows positive results [Ref]

Cons:
• No significant impact on dental plaque [Ref]
• Small magnitude of inhibition [Ref]
• Longer treatment periods may be required [Ref]`;

            const filteredProjects = mockProjects.filter(p =>
                p.name.toLowerCase().includes(projectSearchQuery.toLowerCase())
            );

            const filteredSources = mockSources.filter(s =>
                s.title.toLowerCase().includes(sourceSearchQuery.toLowerCase()) ||
                s.authors.toLowerCase().includes(sourceSearchQuery.toLowerCase())
            );

            const handleSelectProject = (project) => {
                setSelectedProject(project);
                setIsProjectDropdownOpen(false);
                setProjectSearchQuery('');
            };

            const handleAskIgor = () => {
                if (!askIgorQuery.trim()) return;
                setIsLoadingIgor(true);
                setTimeout(() => {
                    setAskIgorResponse(mockAskIgorResponse);
                    setIsLoadingIgor(false);
                }, 1500);
            };

            const handleFindNewSources = () => {
                if (!newSourceQuery.trim()) return;
                setIsLoadingNewSources(true);
                setTimeout(() => {
                    setNewSources([
                        { id: 101, year: 2023, authors: 'Smith J.', title: 'Recent advances in treatment', type: 'Science' }
                    ]);
                    setIsLoadingNewSources(false);
                }, 1500);
            };

            const insertSource = (source) => {
                const citation = `${source.authors} (${source.year}). ${source.title}.`;
                alert('Citation inserted: ' + citation);
            };

            const insertToDocument = (text) => {
                alert('Content inserted to document');
            };

            return React.createElement('div', {
                style: { 
                    height: '100vh', 
                    backgroundColor: '#0A0C12', 
                    display: 'flex', 
                    flexDirection: 'column',
                    color: '#F9FAF9',
                    position: 'relative'
                }
            }, [
                // Background effects
                React.createElement('div', {
                    key: 'bg',
                    style: { position: 'absolute', inset: 0, overflow: 'hidden', pointerEvents: 'none' }
                }, [
                    React.createElement('div', {
                        key: 'bg1',
                        className: 'animate-pulse',
                        style: { 
                            position: 'absolute', 
                            top: '25%', 
                            left: '-3rem', 
                            width: '12rem', 
                            height: '12rem', 
                            backgroundColor: '#FDFF00', 
                            opacity: 0.05, 
                            filter: 'blur(3rem)', 
                            borderRadius: '9999px' 
                        }
                    }),
                    React.createElement('div', {
                        key: 'bg2',
                        style: { 
                            position: 'absolute', 
                            bottom: '33%', 
                            right: '-3rem', 
                            width: '10rem', 
                            height: '10rem', 
                            backgroundColor: '#006A86', 
                            opacity: 0.1, 
                            filter: 'blur(3rem)', 
                            borderRadius: '9999px' 
                        }
                    })
                ]),
                // Header
                React.createElement('div', {
                    key: 'header',
                    style: { 
                        position: 'relative', 
                        zIndex: 10, 
                        padding: '12px 16px', 
                        borderBottom: '1px solid rgba(0, 106, 134, 0.2)' 
                    }
                }, [
                    React.createElement('div', {
                        key: 'title',
                        style: { fontSize: '20px', fontWeight: 300, marginBottom: '8px' }
                    }, [
                        React.createElement('span', { key: 'find', style: { color: '#FDFF00' } }, 'Find'),
                        React.createElement('span', { key: 'est' }, 'est')
                    ]),
                    React.createElement('div', {
                        key: 'divider',
                        style: { 
                            height: '2px', 
                            width: '100%', 
                            background: 'linear-gradient(to right, #006A86, #FDFF00, transparent)', 
                            borderRadius: '9999px', 
                            opacity: 0.3 
                        }
                    })
                ]),
                // Main content
                React.createElement('div', {
                    key: 'main',
                    style: { position: 'relative', zIndex: 10, flex: 1, overflow: 'auto', padding: '16px' }
                }, [
                    React.createElement('div', { key: 'content' }, [
                        // Project dropdown
                        React.createElement('div', { key: 'project', style: { marginBottom: '16px' } }, [
                            React.createElement('label', {
                                key: 'label',
                                style: { 
                                    display: 'block', 
                                    fontSize: '11px', 
                                    color: 'rgba(249, 250, 249, 0.7)', 
                                    marginBottom: '6px',
                                    textTransform: 'uppercase'
                                }
                            }, 'PROJECT'),
                            React.createElement('select', {
                                key: 'select',
                                onChange: (e) => {
                                    const p = mockProjects.find(proj => proj.id === parseInt(e.target.value));
                                    if (p) handleSelectProject(p);
                                },
                                style: {
                                    width: '100%',
                                    backgroundColor: '#0A0C12',
                                    border: '1px solid rgba(0, 106, 134, 0.4)',
                                    borderRadius: '6px',
                                    padding: '8px 12px',
                                    fontSize: '13px',
                                    color: '#F9FAF9'
                                }
                            }, [
                                React.createElement('option', { key: 'default', value: '' }, 'Select a project...'),
                                ...mockProjects.map(p => 
                                    React.createElement('option', { key: p.id, value: p.id }, p.name)
                                )
                            ])
                        ]),
                        // Show sources and Q&A only if project selected
                        selectedProject && React.createElement('div', { key: 'selected' }, [
                            React.createElement('h3', {
                                key: 'sources-title',
                                style: { fontSize: '13px', color: '#F9FAF9', marginBottom: '12px' }
                            }, 'Sources'),
                            React.createElement('div', {
                                key: 'sources',
                                className: 'scrollable',
                                style: { maxHeight: '200px', marginBottom: '20px' }
                            }, filteredSources.map(s =>
                                React.createElement('div', {
                                    key: s.id,
                                    style: { 
                                        marginBottom: '16px', 
                                        paddingBottom: '16px', 
                                        borderBottom: '1px solid rgba(0, 106, 134, 0.15)' 
                                    }
                                }, [
                                    React.createElement('div', {
                                        key: 'title',
                                        style: { fontSize: '13px', color: '#F9FAF9', marginBottom: '8px', fontWeight: 500 }
                                    }, s.title),
                                    React.createElement('div', {
                                        key: 'meta',
                                        style: { fontSize: '12px', color: '#84A7E2', marginBottom: '8px' }
                                    }, `${s.year} · ${s.authors}`),
                                    React.createElement('button', {
                                        key: 'btn',
                                        onClick: () => insertSource(s),
                                        style: {
                                            background: 'none',
                                            border: 'none',
                                            color: '#FDFF00',
                                            fontSize: '11px',
                                            cursor: 'pointer'
                                        }
                                    }, '← Insert')
                                ])
                            )),
                            React.createElement('h3', {
                                key: 'igor-title',
                                style: { fontSize: '13px', color: '#F9FAF9', marginBottom: '12px', marginTop: '20px' }
                            }, 'AskIGOR Q&A'),
                            React.createElement('textarea', {
                                key: 'textarea',
                                placeholder: 'Ask a question...',
                                value: askIgorQuery,
                                onChange: (e) => setAskIgorQuery(e.target.value),
                                style: {
                                    width: '100%',
                                    backgroundColor: '#0A0C12',
                                    border: '1px solid rgba(0, 106, 134, 0.3)',
                                    borderRadius: '6px',
                                    padding: '8px',
                                    fontSize: '12px',
                                    color: '#F9FAF9',
                                    resize: 'none',
                                    minHeight: '60px',
                                    marginBottom: '8px'
                                }
                            }),
                            React.createElement('button', {
                                key: 'igor-btn',
                                onClick: handleAskIgor,
                                disabled: isLoadingIgor || !askIgorQuery.trim(),
                                style: {
                                    width: '100%',
                                    backgroundColor: '#FDFF00',
                                    color: '#0A0C12',
                                    padding: '8px',
                                    borderRadius: '6px',
                                    fontSize: '12px',
                                    fontWeight: 500,
                                    border: 'none',
                                    cursor: 'pointer',
                                    marginBottom: '12px'
                                }
                            }, isLoadingIgor ? 'Analyzing...' : 'Ask IGOR'),
                            askIgorResponse && React.createElement('div', {
                                key: 'response',
                                className: 'scrollable',
                                style: { 
                                    maxHeight: '200px', 
                                    fontSize: '12px', 
                                    whiteSpace: 'pre-wrap', 
                                    lineHeight: '1.6',
                                    marginBottom: '12px'
                                }
                            }, askIgorResponse),
                            askIgorResponse && React.createElement('button', {
                                key: 'insert-btn',
                                onClick: () => insertToDocument(askIgorResponse),
                                style: {
                                    width: '100%',
                                    background: 'linear-gradient(to right, #006A86, #84A7E2)',
                                    color: '#F9FAF9',
                                    padding: '8px',
                                    borderRadius: '6px',
                                    fontSize: '12px',
                                    border: 'none',
                                    cursor: 'pointer'
                                }
                            }, 'Insert to Document')
                        ])
                    ])
                ])
            ]);
        };

        // Wait for Office to be ready
        if (typeof Office !== 'undefined') {
            Office.onReady(() => {
                ReactDOM.render(React.createElement(FindestAddin), document.getElementById('root'));
            });
        } else {
            // Fallback if Office.js isn't loaded
            window.addEventListener('DOMContentLoaded', () => {
                ReactDOM.render(React.createElement(FindestAddin), document.getElementById('root'));
            });
        }
    </script>
</body>
</html>
